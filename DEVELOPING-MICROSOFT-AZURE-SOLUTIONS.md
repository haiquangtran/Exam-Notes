# Developing Microsoft Azure Solutions

## Sections of the exam
## **Create and manage Azure Resource Manager (ARM) Virtual Machines**
  - Virtual Machines
    - Manage through Portal, PowerShell (mainly for DevOps) or REST API.
    - Consists of Virtual Network, a Cloud Service wrapper with a Virtual Machine in that wrapper, with a storage account that contains an Image, OS Disk, and Data Disk(s).
  - Deployment
    - Do it in the Azure market place.
    - Can select existing VM images
    - Can use PowerShell and deploy using PowerShell too
    - There are also JSON ARM Templates which allow for intelliSense and fast set up
  - Deployment slots
    - Like environments (prod, stage etc)
    - With each deployment slot, you can create up to four additional deployment slots (for a total of five) that you can swap with the productionslot (or other non-prod slots)
    - When you swap, the site content and certain slot configurations are exchanged with no downtime. 
    - All deployment slots for a given website share the same web hosting plan and are created within the same VM hosting the prod slot. Therefore, because when stress testing on a non-prod slot as it can affect the prod slot.
  - Swapping and website configuration
    - When you swap deployment slots, all the website content is swapped, but not the configuration. The following configuration items will mvoe to the destination slot:
      - general settings (e.g. .NET framework version, web sockets etc)
      - connection strings, handler mappings, application and site diagnostics setting
      - Monitoring settings
    - The following configuration does not move to the destination slot:
      - Publishing endpoints, custom domain names, SSL certificates and bindings
      - Scale settings
    - So set everything up properly in prod slot so you don't have to worry about overrides when swapping      
  - Create new web hosting plan
    - A web hosting plan is unique to the region, resource group, and subscription. In other words, 2 websites participate in the same web hosting plan only when they are created in the same subscription, resource group, and region (with same pricing tier requirements).
    - Web hosting plans are created as a part of website creation and not created directly.
  - Migrating websites between hosting plans
    - Migrate a website between web hosting plans to change the scale of the website, to leverage the features of a different pricing tier, or to redistribute the website hosting load, all without affecting the other websites belonging to the web hosting plan currently in use. 
    - Websites can migrated between web hosting plans if they meet two conditions: The website and web hosting plan reside in the same region, and the web hosting plans in qustion must be a part of the same resource group.
  - ARM Templates Portal 
    - Custom deployment allows you to create a template from scratch
  - Desired State Configuration
    - Allows you to preset/set the VM to a desired state
    - Usually will be seen in the template.
  - Uploading Images
    - Create a custom image from an existing machine using Sys prep or the system preparation tool
    - This allows you to create a template of an existing machine that we can continue to use within Azure as a new virtual machine
  - Availability Sets
    - Availability sets are NOT created by default
    - You have to create the Availability Set WITH the virtual machine
    - VMs may be impacted by unplanned outages such as power cuts, networks etc. Or during planned maintenance, we need to understand were patching the underlying host OS. These will run as a VM but we yet we still need to patch the Host we still need the VMs to be available. When you create a availability set you will have upgrade domains and fault domains. 
    - Planned vs unplanned maintenance
      - Configure multiple VMs in an availability set for redundancy
      - Configure each application tier into separate availability sets
      - Combine a Load Balancer with availability sets
      - Use multiple storage accounts for each availability set
    - Upgrade domains
      - Is for underlying patching
      - Five (non-user configurable) domains by default
      - The upgrade domains are groups of VMs that are rebooted at the same time for patching.
      - Groups of VMs and hardware that can be rebooted at the same time
    - Fault domains
      - A fault domain is a rack of servers. So 2 VMs in the saem availability set means Azure will provision them into 2 different racks. 
      - Separate hardware & network (Incase of a network switch, or power outage, or hardware failure)
      - 2 domains by default
      - Group of VMs that share a common power source and network switch 
  - Storage replication options
    - Locally redundant
	  - Default
	  - up to 3 nodes in same data center
	- Zone redundant storage
	  - up to 3 data centers in the same region
	- Geo-redundant storage
	  - Data center in a different region
	- Read-access geo-redundant storage
	  - Data center in a different region 
	  - Secondary data can be read (read-only not write).
  - ARM VM Storage
    - Configure disk caching
      - Input/output operations per second (IOPS)
      - Throughput (Mbps)
      - Read/write vs Read and striping
  - Storage capacity
    - Sizing and egress traffic limits (there are scalability and performance targets regarding storage for a VM)
  - Azure File Service
    - SMB file shares from the VM
    - Can be used from the File system I/O APIs
  - Premium vs Standard
    - Prem: high-performance, low-latency disk support for I/O intensive workloads
  - VM Networking
    - Network Security Group (NSG)
      - A virtual network device which has ACL rules that allow/deny network traffic
      - Can only be applied to resources within the region it was created
      - Diagnostic logging capability
      - Associating (NSG to Network Interface Card (NIC), NSG to subnet) - ONE NSG to a NIC or subnet
    - User Defined Routes (UDRs) / Route tables
      - Specify the next hop for packets flowing to a specific subnet
      - Force tunnelling to the internet via your on-premises network
      - Network Virtual Appliance
      - Routes selected in order of 1. UDR, 2. BGP (with ExpressRoute), 3. System Route
      - Use of virtual appliances in your Azure environment
      - System Routes
        - 3 Default Rules: Local vNet, On-premises, Internet
          - Any subnet to another w/in a VNet.
          - From VMs to the internet
          - From VNet to another VNet via VPN gateway
          - From a VNet to another VNet through VNet Peering
          - From a VNet to on-premises network via VPN gateway
    - Application Gateway
      - Load balancing
        - Websocket traffic
        - Sticky session apps
        - SSL offload
  - VM Scale Sets
    - Identical set of VMs
      - PaaS-like autoscale
      - Focus is load and elastic in and out (can scale up and down)
    - Scaling
      - PaaS-like autoscale using autoScaleSettings in ARM template
        - Rules using metricTriggers
      - Can combine Desired State Configuration extension
      - Initial scale setting using ARM template: "sku" : { "name" : "Standard_A0", "tier": "Standard", "capcity": 3 }
        - Can configure a Vms scale set's scaling capabilites in the template.
   - Notes:
     - All deployment slots for the same Web App are hosted within the same Virtual Machine (VM). This is especially important to remember when stress testing a non-production deployment slot before swapping it into production. A significant amount of load on a non-production deployment slot can affect the performance of the live, production Web App.
  - Defining and using request handler mappings
    - Request handler mappings, or handler,s instruct websites how to handle requests for files with particular file extensions by running a script that processes the request. 
    - These handlers are invoked instead of websites performing furter processing on the request (e.g. if handler is configured, the request does not get to ASP.NET).
    - Set these in the azure portal in your website settings/application settings and scroll down to handler mappings.
      - Note: the processor path has to be an absolute path. 
  - Defining and using Virtual directories and virtual applications
    - Use virtual directories to define a hierarchy of web content that is potentially different from the physical directory structure of the web content as it appears on disk. 
    - Can change how the hierarchy is exposed to the brwoser without altering the file structure, and you can collapse deeply nested directory strcutures by reprsenting them with a top-level virtual directory. i.e. you can create a VD such as /images to map to the physical path of the iamges site/wwwroot/static/content/current/images etc 
    - Can also isolate a VD within it's own w3wp.exe worked process by making it an application. i.e. Might ahve 3 separate web applications: /website, /blog, /store (configure and run as virtual applications under the same website)
    - Create under website settings: to make this a virtual application, select the application checkbox.
  - Custom domain names:
    -  The IP address that you get by following the preceding steps will change if you move your website to a Free web hosting plan, if you delete and re-create it, or if you subsequently enable SSL with the IP-based type. This can also happen unintentionally if you reach your spending limit and the website is changed to the Free web hosting plan mode. If the IP address changes and you are using an A record to map your custom domain to your website, you will need to update the value of the A record to use the new IP address. 
  - Using certificates with your custom domain
    - Custom domain names and SSL certificates are linked. To create a certificate, you need a custom domain name. High level steps:
      - Complete steps for enabling custom domain for your website
      - Create a certifcate signing request (CSR) on a local machine using one of the tools: IIS manager, Open SSL, Makecert, Certreq.exe and CertMgr.msc
      - Request a certificate from a certificate authority, and submit your CSR as part of that request
      - Using the tool you used to gerenate the CSR (running on the same machine), export the certficate as a personal information exchange (*.pfx) file that bundles both the private and public keys
      - Upload the .pfx certifcate to your website using portal
      - Bind your domain name to the uploaded certificate using the portal
      - Certificate requirements in Azure:
        - must contain both public and private keys
        - needs to be created for key exchange and ultimately must be exportable to a .pfx file
        - Subject name in the certificate must match the domain used to access the website
        - The certificate needs to use 2,048-bit encryption at minimum.
  - Summary
    - App settings, connection strings, handlers, and Virtual directories can be configured using the management portal under your website settings
    - Custom domains can be mappyed to your websites, but doing so requires you to validate ownership fot he domain by adding a record to DNS
    - Websites can be configured to use SSL and support utilizing multiple certificates per website instance
    - Beyond using the portal, you can manage websites by using the API, PowerShell, and the xplat-cli.
  - Diagnostics for websites
    - Configuring alerts
      - Navigate to website in portal
      - Operations and click Alert rules
      - Add alert
    - Diagnostic data can be stored locally on the website or in Azure Storage and later retrieved by using SCM, downloading from the website vai FTP, viewed via SCM streaming logs, or retrieved from Azure Storage.
    - You can use VS to attach a website instance with remote debugging, but you should be careful in doing so because hitting breakpoints will stop your website isntance from responding to all requests
    - Websites can be configured to use outside-in endpoint monitoring to remotely monitor the availability and responsiveness of your website, and tehse metrics can also be used as alerts sent out via email when configured thresholds are crossed.
    - You can monitor website resources using the management portal
    - You can configure alerts for your website 
## **Design and implement a storage and data strategy**
  - Azure Storage and Azure SQL Database are important in Microsoft Azure PaaS strategy for storage. 
  - Azure Storage 
    - https://docs.microsoft.com/en-us/azure/storage/storage-introduction#what-is-azure-storage
    - Enables storage and retrieval of large amounts of unstructured data
    - Documents, media in the Blob service, Table service for NoSQL data, queue service for reliable messages, file service for server message block file share scenarios. 
  - Azure SQL Database
    - Provides classic relational database features as part of an elastic scale service. 
  - Storage
  	- Blobs / Files 
      - You can use a blob naming convention similar to folder paths to create a logical hierarchy for blobs, which is useful for query operations.
  	  - A blob is accessed from a container within a storage account. From there, we actually access the particular blob.
      - In a blob account you can have many containers which are similar to folders. You can set security on the entire container. Each blob account can store up to 500 TB of data. 
        - Container access permissions 
          - Can be changed through the management portal, or Windows PowerShell or by configuring it programmatically.
          - Private: all access to the container and its blobs require authentication
          - Public container: All access to the container and its blobs are anonymous
          - Public blob: You cannot list blobs in the container without authentication, but you can navigate to the blob URL, if you have it, read it anonymously.
  	  - A SAS token is the gateway that allows us with security to access our particular blob. (Like a valet key in a car that allows you to access a particular storage location)
      - Uploading a blob
        - Many approaches:
          - Using the AzCopy tool
          - Directly using Storage API and writing HTTP requests
          - Using Storage Client Library
          - Using PowerShell cmdlets
      - AzCopy is a useful utility for activities such as uploading blobs, transferring blobs from one container or storage account to antoher, and performing these and other activities related to blob management in scripted batch operations.
      - Reading data
        - Can anonymously read blob storage content directly using a browser if public access to blobs is enabled .The URL to your blob content takes this format: https://<your account name>.blob.core.windows.net/<your container name>/<your path and filename>
        - Can also read it in Azure.portal by navigating tot he container.
        - Can also read it using Visual Studio
      - Changing data
        - Modify contents of a blob or delete using Storage API directly, but its more common to do it programmatically as part of an application, e.g. using the Storage Client Library.
      - Streaming data using blobs
        - Can stream blobs by downloading to a stream using the DownloadToStream() API method. 
        - Avoids loading the entire blob into memory, e.g. before saving it to a file or returning it to a web request.
      - **Authentication for storage account and content**
        - has HTTP and HTTPS
        - Shared Key: made from set of fields related to the request. Computed with SHA-256 algorithm and encoded in Base64.
        - Shared Key Lite: Similar to Shared Key, but compatible with previous versions of Azure Storage. Provides backward compatibility, allowing migration to newer versions with minimal changes.
        - Shared Access Signature: Grants restricted access rights to containers and blobs. You can provide a shared access signature to users you don't trust with your storage account key. Gives them specific permissions to the resource for a specified amount of time.
  	  - Types
	  	  - **Block Blob**
          - Block blobs allow you to upload, store, and download large blobs in blocks up to 4 MB each. The size of the blob can be up to 200GB.
          - Great for non-sequential reads and writes, like the VHD on a hard disk 
          - Blobs that are divided into blocks. Each block can be up to 4 MB. 
          - You can set the final order of the block blob at the end of the upload process.
          - For large files, you can upload blocks in parrallel.
          - Can upload blocks and then assemble the block blob after the fact. 
          - Any blocks uploaded that are not committed to a blob will be deleted after a week. Block blobs can be up to 200GB. 
	  	  - **Page Blob**
          - Blobs comprised of 512-byte pages. Unlike block blobs, page blob writes are done in place and are immediately committed to the file. 
          - The max size of a page blob is 1 TB. 
          - Closely mimic how hard drives behave, in fact, Azure VMs use them for that purpose. Most of the time you will use block blobs.
	  	  - **Append Blob**
      - Configuring the CDN
        - By default, blobs have a 7 day time to live at the CDN edge node. After that, the blob is refreshed from the storage account to the edge node. Blobs that are shared via CDN must support anonymous access. 
        - It can take 60 minutes before the CDN is ready for use on the storage account!
        - Azure portal: 
          - https://docs.microsoft.com/en-us/azure/cdn/cdn-create-a-storage-account-with-cdn
          - Create storage account
          - Create a new CDN profile
          - Create a new CDN endpoint
          - Access CDN content
          - Remove content from the CDN
      - Configuring custom domains
        - By default, the URL for accessing the Blob service in a storage account is https://<account name>.blob.core.windows.net. You can map your own domain or subdomain to the Blob service for your storage account so that users can reach it using the custom domain or subdomain.
      - Scaling Blob Storage
        - Blobs are partitioned by container name and blob name, which means each blob can have its own partition. 
        - Blobs, therefore, can be distributed across many servers to scale access even though they are logically grouped within a container. 
	  - Files
	    - Files are accessible via SMB interface as a file share
	    - Can also access those files using the RESTful APIs
	  - Azure Blobs vs Azure Files
	    - Accessibility: Blob = REST APIs, Files = REST APIs, or SMB interface
	    - Endpoints: Blob = myaccount.blob.core.windows.net/mycontainer/myblob, Files = myaccount.file.core.windows.net\myshare\myfile.txt
	    - Capacity: Blob = Up to 500TB containers, Files = 5TB file shares
	    - Throughput: Blob = Up to 60 MB/s per blob, Files = Up to 60 MB/ps per share
	    - Billed capacity: Blob = based on bytes written, Files = based on file size
  	- Tables
  	  - Uses ODATA interface or a TableClient to interface with the Table storage
  	  - Uses an account that has tables, which has individual entities within it - you access the entities
  	  - Uses a SAS token as a gateway into the account for security
  	- Queues
  	  - QueueClient which interfaces to the Queue storage
  	  - Stored within an account, within a table, within a entities (entities are inside the queue)
  	  - Uses a SAS token as a gateway into the account for security 
  	- Redis Cache
  	  - Tiers: Basic, Standard & Premium
  	  - Concurrency
  	    - Optimistic vs pessimistic
  	  - Distributed app caching
  	    - Shared vs Private
  	    - Data persistence 
  	    - Clustering
  	- Monitoring 
  	- SQL DB
  	  - Tiers: Basic, Standard, Premium versions etc. You can migrate between the tiers using the Portal, PowerShell or REST API
  	  - SQL DB maintains global mapping information about all shards (DBs) in a shard set
  	  - Metadata used to route based on sharding key
  	- Search
  	  - Index: Persistent store of documents
  	  - Add data (Push JSON data with .NET SDK or REST API, Pull with indexers supporting Azure sotrage and .NET SDK or REST API)
  	  - Handle Results
  	    - Total hits and page counts
  	    - Layout results
  	    - Sorting and filtering
  - Access control with Shared Access Signature (SAS)
    - Application requests a SAS Token from the SAS Service
    - SAS Token gets generated and gets handed to Application
    - Application then makes a storage request to Azure Storage with the SAS Token
    - Azure Storage responds
  - Storage Access
    - Access through RESTFUL api:
    - Blobs: //[account].blob.core.windows.net/[container]/[blob]
    - Files: //[account].file.core.windows.net/[file]
    - Tables: //[account].table.core.windows.net/[table]([paritition key], [row key])
    - Queues: //[account].queue.core.windows.net/[queue]
  - Azure Storage Service Encruption (SSE)
    - Features
      - 256 BIT AES Encryption 
      - Block, Page and Append Blobs
      - General purpose and Blob Storage Accounts
      - All redundancy levels and all regions
      - Only applicable for ARM, not ASM
    - Limitations
      - The following are not encryped:
	      - Classic storage and classic migrated are not included. 
	      - Existing data before turned on is not included. 
	      - Tables, Queues, and Files data 
	  - i.e. If you want the encryption you have to enable it at the beginning right away.
## **Design and implement Azure PaaS compute and web and mobile services**
  - Web & Mobile
    - App Service (Web apps, Mobile apps, API apps and logic apps)
      - Features:
        - Auto-patching and auto-scale
        - .NET, Java, Node.js, PHP, Python
        - Integrate with SaaS and on-premises (resources)
        - Continuous integration with VSTS, Github, BitBucket and more.
      - Web apps
        - Deployment
          - Hosting
            - Need to establish a resource group that has an App service plan.
            - From there you are going to deploy and host your Web application.
        - Diagnostics
          - Azure Application Insights
            - Monitor: WebApps, ASP.NET, Java Apps, Windows Services, Docker apps, JS, SharePoint Sites, Node, PHP, Ruby, Python, Objective-C etc.
          - DevOps Cycle
            - Azure Applications Insights helps devops.
            - Detect, Triage, Diagnose
            - Monitor performance, failures, usage
        - Web Jobs
          - Can be run using On-Demand or Scheduled initiation
          - A Web Job runs inside a web app (Runs on the same process)
          - Creating WebJobs
            - Uploaded in a zip file
            - Types: Python, Batch, PowerShell, Java, .NET
            - Scheduling: settings.job file at root of zip file or just use the Azure UI 
          - Configuration of WebJobs
            - Run it continously, or one time, or on-demand
        - Scaling
          - Azure Traffic Manager
          	- Can have multiple instances of these storage solutions and scale between them by using Azure Traffic Manager
          	- Azure Traffic Manager routes the traffic to different instances/websites
          - Scalable and global web app and database
            - Scale quickly with a slider bar, from a schedule, or based on CPU load
            - Route users globally to copies of Web Apps and SQL Databases
            - Improve performance by using a distributed cache layer
        - Resillience
          - Isolating a web app
            - Web app with Personally Identifiable Information (PII) and database
              - Secure the web app with the PII from malicious requests etc
              - Host resources isolated and securely
              - Block malicious requests through active defense firewalls
              - Access on-premises resources from a cloud environment with a secure connection'
      - Mobile apps
       	  - Adding mobile features to a web app
            - Native or Xamarin-native mobile client app that connects to an Azure Mobile App backend and shares data and APIs with an Azure Web App
          	  - Create cross-platform mobile clients easily and consistently
          	  - Share data and APIs as-is across mobile and web
          	  - Enable mobile back-end featuers for push notifications, offline data sync, and auto-scaling
      - API apps
      - logic apps
    - API Management
      - Create Managed APIs
        - Think of it as an area to host the APIs
        - API Gateway + Developer Portal + Publisher Portal
          - Gateway is like a proxy providing rate limits, applying policies, customize the developer portal
          - Developer Portal - developers come to a developer portal to access the API
          - Can add caching
          - Can trace API calls using the API Inspector 
    - Service Fabric
      - Service fabric can run on the public clolud, private cloud, hosted cloud, or on-premises.
      - Modernization with microservices
        - Individually built and deployed
        - Small, independently executing services
        - Integrate using published API calls for overall application's functionality
        - Fine-grained, loosely coupled application
      - Manager microservices at scale
      - CI/CD pipeline endpoint
      - 24x7 service availability
      - Stateful services
      - Containers and Docker
      - Multi-cloud
      - How to deploy and configure Service Fabric?
    - Cloud services
      - PaaS with VM control
        - Simple .NET runtime
        - Health, discovery, updates
        - OS Patching
        - The original PaaS offering from 2010. Best used when low-level OS access is required, but consider the newer PaaS models first.
    - Azure Functions
      - Async, event-driven, serverless experience
      - Respond to events occurring in other Azure services, SaaS products, on-premises systems
      - Only pay while function is executing 
      - Fully open source
## **Manage identity, application, and network services**
  - Azure AD
    - For the cloud and hosted within Azure
    - Supports SharePoint Online, Exchange online etc
    - Can interface to Azure AD using the Graph API (different to on-opremises solutions with AD which uses LDAP to interface with it)
    - Azure Active Directy is separate from Active Directory but can be synchronized to have single sign on etc.
    - **AD On-premises vs Azure AD**
      - Graph API (Azure AD)
        - Programmatic Access to Azure AD | RESTful
        - CRUD | Application must be registered and configured
        - Requests use standard HTTP Methods
      - OAuth (Azure AD)
        - AuthZ web apps and web APIs in Azure AD Tenant 
        - Access authorization, role-based assignment
        - For app and user authorization
      - OpenID Connect (Azure AD)
        - authorize etc
        - AuthZ protocol for SSO
        - Extends Oauth 2.0 for use as AuthN protocol
  - AD B2B/B2C
    - AD B2C:
      - How does Business 2 Consumer fit in?
      - What is it for?
        - Developers working on Consumer and citizen-facing mobile and web apps that reach out to the customers directly
      - Using social accounts such as FB, twitter etc using OAuth 
      - Manageability: Self-service and seamless identity experience
      - Can use Graph API to access Azure AD to look for that info
      - Can enable multi-factor authentication
      - Has protocol support (OAuth2 etc)
    - AD B2B:
      - What is Business 2 Business used for?
        - Mainly for IT pros providing access to their organisations data and application to partner organizations and collaborators
        - It's for partner users that are acting or behalf of representatives or employees from their orgnaisation
      - Manageability: Access reviews, email verification, allowlist/denylist, etc... govern access to host application and resources
  - Communicate
    - Azure Service Bus
      - Queues
        - FIFO Queues
        - Simple Client
      - Topics
        - Targeting Messages
        - Work with Queues
      - Relay
        - Expose OnPrem service to public
        - Leverage WCF
      - Notification Hubs 
        - Push notification infrastructure
        - Support for non-MSFT targets
      - **Service Bus Queue vs Storage Queue**
        - Service bus queues
          - FIFO guaranteed
          - Delivery once and only once
          - 60 second default locks can be renewed
          - Messages are finalized once consumed
          - Native integration with WCF and WF
        - Storage queues
          - Order not guaranteed
          - Delivery at least once, maybe multiple times
          - 30 second default locks, extendable to 7 days
          - In-place updates of content
          - Can integrate with WF through custom activity