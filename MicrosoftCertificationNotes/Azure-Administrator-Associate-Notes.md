# Microsoft Certified: Azure Administrator Associate Notes
- Exam AZ-103: [Microsoft Azure Administrator](https://docs.microsoft.com/en-us/learn/certifications/azure-administrator?wt.mc_id=learningredirect_certs-web-wwl&tab=tab-learning-paths) ([skills measured outline](https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RE3VwUF))

## Exam study resources
- https://ravikirans.com/az-103-study-guide/
- https://absolute-sharepoint.com/az-103-study-guide-microsoft-azure-administrator
- https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RE2PjDI
- https://www.whizlabs.com/blog/azure-certifications-path/
- https://www.udemy.com/course/the-complete-walkthrough-of-microsoft-azure-services/

## Microsoft Learning Module Notes
- **Securing Data**
  - Cloud secruity is a shared responsibility
    - IaaS: still have to patch/secure OS & software and secure network.
      - Security advantage of having outsourced conern over protecting physical network
    - PaaS: outsources a lot of security concerns. Security for OS and software is outsourced. Can still control stuff in Azure Portal.
    - SaaS: outsources everything.
  - You always retain responsibility for securing the following:
    - Data
    - Endpoints
    - Accounts
    - Access management
  - **Defense in depth (Layered approach)**
    - Strategy to slow the advance of an attack trying to get unauthorized access to info.
    - Each layer provides protection, if one is breached then there is another layer as a safe net etc.
      - Can provide alert telemtry that can be acted upon 
    - Microsoft applies a layered approach to security, both in physical data centers and across Azure services
  - **Layers:**
    - **Data**
      - Almost all attackers are after this (DB, disk inside VM, etc)
    - **Application**
      - Store sensitive application in a secure storage medium
    - **Compute**
      - Secure access to VMs
      - Implement endpoint protection
      - Keep systems patched and current
    - **Networking**
      - Secure outbound/inbound internet access by limiting to only what is needed
      - Limit communication between resources
      - Deny by default
      - Implement secure connectivity to on-premises networks.
    - **Perimeter**
      - Use DDoS protection to filter large-scale attacks
      - Use perimeter firewalls to identify and alert malicious attacks against network
      - Protect from network-based attacks against your resources
    - **Identity and Access**
      - Control access to infrastructure and change control
      - Use SSO and multi-factor auth
      - Audit events & changes
    - **Physical security**
      - Controlling access to hardware within data center is first line of defence
- References:
  - https://docs.microsoft.com/en-gb/learn/modules/intro-to-security-in-azure/2-shared-responsibility
  
- **Azure Security Center**
  - Monitoring service for threat protection across all services in Azure, and on-premises. 
  - **Can do the following:**
    - Security recommendations
    - Monitor security settings and apply required security to new services as they come online 
    - Monitor all services and perform automatic security assessments to identify potential vulnerabilities
    - Use ML to detect and block malware from being installed
    - Identify potential inbound attacks
    - JIT access control for ports
  - **Available tiers**
    - Free - Limited to assessments and recommendations of Azure resources only.
    - Standard - full suite of security related services: continous monitoring, threat detction, JIT access control for ports etc
  - References: 
    - https://docs.microsoft.com/en-gb/learn/modules/intro-to-security-in-azure/2a-azure-security-center


- **Identity and access**
 - **Authentication and Authorization**
   - **Authentication**
     - Process of who the user is.
     - Involves act of challenging a party for legitimate credentials, and provides the basis for creating a security principal for identity and access control use. 
     - Establishes if they are who they say they are.
   - **Authorization**
     - Establishing what level of access an authenticated person or service has.
     - Specifies data they're allowed to access and their permissions.
  - Azure Active Directory (Azure AD)
    - Cloud-based identity service
    - Supports synchronizing with on-premises AD.
    - Provides:
      - Authentication
      - SSO
      - Application management (using Azure AD application Proxy, SSO, my apps protal, SaaS apps)
      - B2B identity services (guests, how users sign up, their profiles etc)
        - **Providing identities to services**
          - Credentials typically stored in config files. Anyone with access to these will be able to access these credentials and risk exposure.
          - Azure AD addresses this by using: service principals and managed identities for Azure services.
      - Device Management
  - References:
   - https://docs.microsoft.com/en-gb/learn/modules/intro-to-security-in-azure/3-identity-and-access


### Azure: Providing Identities to Services 
- **Service principals**
  - **Identity** = a thing that can be authenticated (person, application, service, or servers etc)
  - **Principal** = identity acting with certain roles or claims. Groups are often considered principals because they have rights assigned.
  - **Service principal** = identity used by a service or application. And like other identities, it can be **assigned roles**.
  - Creation of service principals can be tedious, making them difficult to maintain etc. Managed identities for Azure services are much easier and will do most of the work for you.
- **Managed Identities for Azure Services**
  - Managed identity can be created instantly for any Azure service that supports it.
  - **Managed identity** = creates account on organisations specific AD (on AD tenant). Azure infrastructure will automatically take care of authenticating the service and managing the account. **Can use account like any other Azure AD account, including securely letting the authenticated service access other Azure resources.**
- **Role-based access control**
  - Roles are sets of permissions, like "Read-only" or "Contributor", that users can be granted to access an Azure service instance.
  - Identities are mapped to roles directly or through group membership
  - Roles assigned at a higher scope, like an entire subscription, are inherited by child scopes, like service instances i.e resource groups and resources inside the RG etc.
- **Privileged Identity Management**
  - Azure AD Privileged Identity Management (PIM) is an additional, paid-for offering
  - Provides **oversight of role assignments, self-service and just-in-time role activation and Azure AD and Azure resource access reviews**.
- **Why separate them all?**
  - Separating security principals, access permissions, and resources provides simple access management and fine-grained control.
  - Can ensure minimum necessary permissions are granted.

### Encryption
- For most, data is most valuable asset.
- **Encryption serves as last and strongest line of defense in a layered security strategy.**
- Encryption = **making data unreadable and unusable to unauthorized viewers. (Needs to be decrypted to be read requiring a secret key)**
  - **Symmetric encryption**
    - Same key to encrypt and decrypt
  - **Asymmetric encryption**
    - public key and private key pair
    - Either key can encrypt but you need **BOTH keys to decrypt**.
- **Encryption is typically approached in two ways**
  1. Encryption at rest
  2. Encryption in transit
- **Encryption at rest**
  - At rest = data stored on a physical medium
  - Ensures data is unreadable without the keys and secrets needed to decrypt it
  - The actual data encrypted could vary in its content, usage, and importance etc.
- **Encryption in transit**
  - Data in transit = data actively moving from one location to another, such as across internet or through private network. 
  - Secure transfer can be handled by several different layers:
    1. Encrypt data at application layer prior to sending it over network. Only the receiver has the secret key that can decrypt the data to a usable form. HTTPS is an example of application layer in transit encryption.
    2. Can set up secure channel, like VPN, at network layer, to transmit data between two systems.
- **Encryption on Azure**
  - **Encrypt raw storage**
    - **Azure Storage Service Encryption** for data at rest. 
      - Automatically encrypts your data before persisting it to Azure Managed Disks, Azure Blob storage, Azure files, or azure queue storage, and decrypts the data before retrieval.
      - Handling of encryption, encryption at rest, decryption and key management in Storage Service Encryption is transparent to applications using the services.
   - **Encrypt virtual machine disks**
     - Azure Storage Service Encryption provides low-level encryption protection for physical disk, but how to ensure virutal hard disks (VHDs) of VMs are protected?
     - **Azure Disk Encryption**
       - Encrypts your Windows and Linuz IaaS feature VM disks. 
       - Leverages industry-standard BitLocker feature of Windows and dm-crypt feature of Linux
       - Integrated with Azure Key Vault to help control disk encryption keys and secrets.
  - **Encrypt databases**
    - **Transparent data encryption (TDE)**
      - **Provides encryption at rest by default for DB etc**
      - Performs real time encryption/decryption of the DB, backups, and transaction log files **at rest (without requiring changes to the application).**
      - TDE is enabled for all new Azure SQL DB instances **by default**.
      - TDE Encrypts storage of entire database using symmetric key (called DB encryption key). By default, Azure provides unique encryption key per logical SQL Server instance and handles all the details.
      - Bring your own key (BYOK) is also supported with Azure Key Vault.
  - **Encrypt secrets**
    - **Azure Key Vault**
      - Centralized cloud service for storing application secrets
      - Provides secure access, permissions control, and access logging capabilities. 
      - Can be used to store API keys, secrets, certificates
      - **Benefits**
        - Centralized application secrets
        - Securely stored secrets and keys
        - Monitor access and use
        - Simplified admin of application secrets (easy to renew certs, scale up and replicate content and use standard cert management tools etc)
        - Integrate with other Azure services (storage accounts, container registries, event hubs etc)     
- References: 
  - https://docs.microsoft.com/en-gb/learn/modules/intro-to-security-in-azure/4-encryption

### **Azure Certificates**
- Transport Layer Security (TLS) is the basis for encryption of website data in transit.
- Uses certificates to encrypt/decrypt data
- However, these certificates have a lifecycle requiring admin management.
- Websites having expired TLS certs open security vulnerabilities.
- **Certs can be signed by trusted cert authority, or be self-signed**
  - Self-signed cert is signed by its own creator (therefore, not trusted by default)
    - Most browser can ignore this problem
    - However, **you should only use self-signed certificates when developing and testing your cloud services.**
    - These certificates can contain a private or public key and have a thumbprint that provides a means to identify a certification in an unambiguous way.
    - This thumbprint is used in the Azure configuration file to identify which certification a cloud service should use.
- **Types of certificates**
  - Certs are used in Azure for two primary purposes:
    1. **Service certificates** are used for **cloud services**
    2. **Management certificates** are used for **authenticating** with the management API.
  - **Service certificates**
    - Attached to cloud services
    - Enable secure communication to and from the service
    - i.e. if you deloy web role, you want to supply a cert that can authenticate an exposed HTTPS endpoint. Services which are defined in your service definition, are automatically deployed to the VM that is running an instance of your role.
    - Upload service certificates to Azure using Portal or using classic deployment model.
      - Service certs are associated with a specific cloud service
      - They are assigned to a deployment in the service definition file.
    - Can managed service certificates separately from your services and can have different people managing them.
      - For example, a developer could upload a service package that refers to a certificate that an IT manager has previously uploaded to Azure. An IT manager can manage and renew that certificate (changing the configuration of the service) without needing to upload a new service package. Updating without a new service package is possible because the logical name, store name, and location of the certificate is in the service definition file, while the certificate thumbprint is specified in the service configuration file.
      - To update the certificate, it's only necessary to upload a new certificate and change the thumbprint value in the service configuration file.
  - **Management certificates**
    - Allows you to authenticate with the classic deployment model.
    - Many programs & tools (i.e. VS or Azure SDK) use these certs to automate configuration and deployment of various Azure Services. **However, these are not really related to cloud services.**
  - **Using Azure Key Vault with certificates**
    - **Automating cert management helps reduce or eliminate error prone task of manual cert management**
    - Can store certs in Azure Key Vault, however, Key Vault provides additional features above and beyond typical certificate management:
      - Can create certs in Key Vault or import existing certs
      - Securely store + manage certs without interaction with prviate key material
      - Create policy that directs Key Vault to manage life-cycle of a cert.
      - Provide contact info for notification about life-cycle events of expiration and renewal of cert
      - Automatically renew certs with selected issuers - Key Vsault partner x509 cert providers/cert authorities
- References:
  - https://docs.microsoft.com/en-gb/learn/modules/intro-to-security-in-azure/4a-certificates

### Protect your network
- **A layered approach to network security (Azure)**
  - **Internet protection**
    - Only allow inbound and outbond communication where necessary
    - Identify all resources that are allowing inbound network traffic of any type, then ensure they are restricted to only the ports and protocols required.
    - **Azure Security Center** allows you to see this information.
      - Identifies internet-facing resources with no network security groups associated
      - Identifies resources that are not secured by a firewall.
  - **Azure Firewall**
    - Service that grants server access based on originating IP address of each address. 
    - You create firewall rules that specify ranges of IP addresses. These generally also include specific network protocol and port info.
    - **To provide inbound protection at the perimeter, you have several choices**
      - **Azure Firewall**
        - Fully stateful firewall as a service with built-in high availability and unrestricted cloud scalability
        - Provides inbound protection for non-HTTP/S protocols (i.e RDP, SSH, FTP etc)
        - Provides outbound, network-level protection for all ports and protocols, and application-level protection for outbound HTTP/S.
      - **Azure Application Gateway**
        - **Load balancer** that includes a **Web Application Firewall (WAF)**, providing protection from known vulnerabilities in websites. (Designed to protect HTTP traffic)
      - **Network virtual appliances (NVAs)**
        - Ideal options for non-HTTP services or advanced configurations, and are similar to hardware firewall appliances.
  - **Distributed Denial of Service (DDoS) protection**
    - **Azure DDoS Protection**
      - Protects Azure applications by monitoring traffic at the Azure network edge before it can impact service's availability. 
      - Within a few minutes of attack detection, you are notified using Azure Monitor metrics.
      - **Tiers**
        - **Basic**
          - **Automatically enabled**
          - Always-on-traffic monitoring and real-time mitigation of common network-level attacks provide same defenses that Microsoft's online services use.
        - **Standard**
          - Additional mitigation capabilities tuned specifcally to Microsoft Azure Virutal Network resources.
          - Requires no application changes
          - Protection policies tuned through dedicated traffic monitoring and ML algorithms
          - Policies applied to public IP addresses deployed in VNs, such as Azure Load Balancer & Application Gateway.
          - Can mitigate the following types of attacks:
            - Volumetric attacks: seemly legit traffic to overload network
            - Protocol attacks: exploit weakness to render a target inaccessible
            - Resource layer attacks: target web app packets to disrupt transmissions of data between hosts
- **Controlling traffic inside your Virtual Network**
  - **Virtual network security**
    - Limit communication between resources to only what is required
    - For communication between VMs, **Network Security Groups (NSGs)** are critical piece to restrict unnecessary communication.
      - Allow you to filter network traffic to and from Azure resources in an Azure virtual network.
      - Can contain multiple inbound and outbound security rules to enable you to filter traffic to and from resources by source and designation IP address, port, and protocol
      - Provide list of allowed and denied communication to and from network interfaces and subnets, and are fully customizable.
      - **Can completely remove public internet access by restricting access to service endpoints.** With service endpoints, Azure service access can be limited to your virtual network.
- **Network integration**
  - **Virtual private network (VPN)**
    - VPN connections are common way of establishing secure communication channels between networks
    - Connection between Azure Virtual Network and an on-premises VPN device is a great way to provide secure communication between your network and your VNet on Azure.
  - **Azure ExpressRoute**
    - Provides dedicated, private connection between your network
    - Lets you extend your on-premises networks into Microsoft cloud over a private connection facilitated by a connectivity provider.
    - Can establish connections to Microsoft cloud services, such as Azure, Office 365 etc. 
    - Improves security of your on-premises communication by sending this traffic over private circuit instead of over the public internet.
    - Do not need to allow access to these services for your end users over the public internet, you can send this traffic through appliances for further traffic inspection.
- References:
  - https://docs.microsoft.com/en-gb/learn/modules/intro-to-security-in-azure/5-network-security

### Protect your shared documents
- **Azure Information Protection (AIP)**
  - Cloud based solution that helps organisations classify and optionally protect documents and emails by applying labels.
  - Classifies content when you save, and suggests a label i.e. Confidential..
  - After it is classified, you can:
    - Analyze data flows 
    - Detect risky behaviours
    - Track access to documents
    - Prevent data leakage or misuse
  - Requires purchase cost
- References:
  - https://docs.microsoft.com/en-gb/learn/modules/intro-to-security-in-azure/6-azure-information-protection

# Azure Advanced Threat Protection (ATP)
- Cloud-based security that identidies, detects, and helps investigate advanced threats, compromised idenities, and malicious insider actions directed at your organization.
- Capable of detecting known malicious attacks and techniques, security issues, and risks against your network.
- **Azure ATP components**
  - **ATP Portal**
    - Has it's own portal
    - Allows you to create Azure ATP instance, and view data recevied from ATP sensors.
    - Monitor, manage, nad investigate threats in your network 
    - You can sign in to the Azure ATP portal at https://portal.atp.azure.com. You must sign in with a user account that is assigned to an Azure AD security group that has access to the Azure ATP portal.
  - **ATP sensor**
    - Installed directly on your domain controllers.
    - Sensor monitors domain controller traffic without requiring a dedicated server or configuring port mirroring.
  - **ATP cloud service**
    - ATP cloud service runs on Azure infrastructure and is deployed in US, Europe and Asia.
    - Connected to Microsoft's intelligent security graph.
- **Purchasing Azure Advanced Threat Protection**
  - available as part of the Enterprise Mobility + Security E5 suite (EMS E5) and as a standalone license.
  -  You can acquire a license directly from the Enterprise Mobility + Security Pricing Options page or through the Cloud Solution Provider (CSP) licensing model. It is not available to purchase via the Azure portal.
    - https://www.microsoft.com/cloud-platform/enterprise-mobility-security-pricing
- References:
  - https://docs.microsoft.com/en-gb/learn/modules/intro-to-security-in-azure/7-advanced-threat-protection

### Understand Security Considerations for Application Lifecycle Management Solutions
- References:
  - https://docs.microsoft.com/en-gb/learn/modules/intro-to-security-in-azure/7a-microsoft-sdl

### Summary with Learn More links
- https://docs.microsoft.com/en-gb/learn/modules/intro-to-security-in-azure/8-summary

### Creating VMs
- Planning and care is required when performing migration of on-premises servers to Azure
  - Can move all at once, or small batches, or individually
  - Sketch out your current infrastructure model and see how it might map to the lcoud
  - Checklist of things to think about:
    - **Start with the network**
      - Virtual Networks (VNets) are used in Azure to provide **private connectivity between Azure VMs and other azure services.**
      - VMs and services that part of the same VNet can access one another.
      - By default, external services of the VNet cannot access/connect inside the VNet. You can configure network to allow access to external service though, including on-premises servers.
      -  Consider the topology of the network before any VMs
      - When you set up a VNet, you specify: available address spaces, subnets, and security. If Vnet connects to other Vnets, then address ranges cannot overlap when selecting them. 
      - Azure will treat any address range as part of the private VNet IP address space if only reachable within the Vnet. within interconnected Vnets, and from your on-premises location.
        - **Segregate your network**
          - Can create one or more subnets for your VNet
          - Do this by breaking network into more manageable sections.
          - For example, you might assign 10.1.0.0 to VMs, 10.2.0.0 to back-end services, and 10.3.0.0 to SQL Server VMs.
        - **Secure the network**
          - By default, no security boundary between subnets (subnets can talk to each other)
          - Can set up NSGs to control traffic to and from subnets and to and from VMs
          - NSGs: act as software firewalls, applying custom rules to each inbound or outbound request at the network interface and subnet level.  
          - Allows you to fully control every network request coming in or out of the VM.
       - **Plan each VM deployment**
         - What does the server communicate with?
         - Which ports are open?
         - Which OS is used?
         - How much disk space is in use?
         - What kind of data does this use? Are there restrictions (legal or otherwise) with not having it on-premises?
         - What sort of CPU, memory, and disk I/O load does the server have? Is there burst traffic to account for?
    - **Name the VM**
      - up to 15 characters on Windows VM
      - up to 64 characters on Linux VM
      - Name alsop defines a manageable azure resource, and it's difficult to change later
      - Follow the conventions to identify what it is: 
        - Environment: dev, prod, QA etc
        - Location: uw (US west), ue (US east) etc
        - Instance 01, 02,
        - Product or service: service
        - Role: sql, web, messaging
        - Example: ``devusc- webvm01`` might represent first dev web server hosted in US south central location.
      - **VMs have several elements needed to do their jobs:**
        - VM itself
        - Storage account for the disks
        - VNet (shared with other VMs and services)
        - Network interface to communicate on the network
        - NSGs to secure the network traffic
        - Public Internet address (optional)
        - Azure creates these resources if required, or youcan give it existing ones. 
        - Each resource needs a name to identify it.
          - **If azure creates the resource, it will use VM name to generate a resource name - another reason to be consistent with your VM names**
    - **Decide location for VM**
      - Location can limit available options. Each region has different hardware and some configurations are not available in all regions.
      - **Price differences between locations. Can be very cost effective to check your required config in multiple regions to find lowest price.**
    - **Size for VM**
      - Type of workload you need to run:
        - **General purpose**: balanced CPU-to-memory ratio. Ideal for testing and dev, small to med DBs, and low to med traffic web servers.
        - **Compute optimized**: high CPU-to-memory ratio. Suitable for med traffic web servers, network appliances, batch processes, and app servers.
        - **Memory optimized**: high memory-to-CPU ratio. good for DB servers, med-large caches, in-memory analytics
        - **Storage optimized**: high disk throughout and IO. good for VMs running DBs
        - **GPU**: targeted for heavy graphics rendering and vid editting. Good for model training and deep learning.
        - **High performance computes**: fastest and most powerful CPU VMs with optional high-throughput network interfaces.
      - **You can upgrade or downgrade VM, as long as current hardware config is allowed in the new size**
        - The VM size can be changed while the VM is running, as long as the new size is available in the current hardware cluster the VM is running on. 
        - If changed while running, VM reboots
        - If you stop and deallocate the VM, you can then select any size available in your region since this removes your VM from the cluster it was running on.
    - **Pricing model**
      - Two separate costs that will be charged for every VM: 
        1. **Compute Costs**
          - **Priced per-hour (i.e. $50/phr)** but **billed on a per-minute (how many mins used)**. i.e Only charged for 55 mins if the VM is deployed for 55 mins. Not charged for compute capacity if you stop and deallocate the VM since this releases the hardwork. The hourly price varies based on the VM size and OS you select. Cost for a VM includes the charge for the Windows OS (Linux OS is cheaper due to no OS license charge). 
        2. **Storage Costs**
          - Charged separately for storage VM uses
          - **The STATUS of the VM has NO RELATION to the storage charges that will be incurred; even if VM is stopped/deallocated and aren't billed for the running VM, you will be charged for the storage used by the disks**
          - Can choose two payment options for compute costs:
            1. **Pay as you go** - pay for compute capacity by the second (no longer term commitment or upfront payments).
            2. **Reserved Virtual Machine instances** - is an advance purchase of a VM for 1 or 3 years in specified region. Commitment is made up front, and in return, you get up to 72% price savings compared to PAYG. RIs are 
              - RIs are flexible and can easily be exchanged or returned for early termination fee.
    - **Storage for VM**
      - Azure VMs have at least 2 VHDs. 
        - VHD 1: stores OS
        - VHD 2: used as temporary storage.
        - Can add more VHDs depending on VM size.
        - **Data for each VHD held in Azure Storage** as page **blobs**. It's how storage cost is measured.
      - **Azure Storage**
        - Storage account provides access to objects in Azure Storage for a specific subscription. 
        - VMs always have one or more storage accounts to hold each attached virtual disk.
        - **Virtual Disks can be backed by either Standard or Premium storage accounts.**
          - **Premium** = SSDs for high performance and low latency for VMs running I/O intensive workloads. **Use for production workloads, especially those sensitive to performance variations or are I/O intensive**.
          - **Standard** = For development or testing, standard storage is fine.
        - **Creating disks (two options) for relationship between storage account and each VHD**
          - **Unmanaged disks:**
            - Responsible for the storage accounts used to hold the VHDs for your VM disks
            - Pay storage account rates for space used
            - Single storage account has fixed-rate limit of 20,000 I/O operations/sec.
            - **Capable of supporting 40 standard virtual hard disks at full utilization.**
            - **If need to scale out with more disks, you need more storage accounts which gets complicated.**
          - **Managed disks:**
            - **Newer and recommended disk storage model**
            - Azure manages the storage accounts 
            - You specify size of disk, up to 4 TB, and Azure creates and manages **both the disk and the storage.**
            - **Do not have to worry about storage account limits, making managed disks easier to scale out.**
    - **Select an Operating System (OS)**
      - Windows (more expensive due to OS license fees), Linux (cheaper)
      - **Choice of OS will influence hourly compute pricing as Azure bundles cost of the OS license into price.**
      - Can also use marketplace to install images of stacks. i.e. Wordpress site = Linux server, Apache web server, MySQL db and PHP.
      - Can create your disk image with what you need, upload it to azure storage, and use it to create an azure VM. **Azure only supports 64-bit OS.**
- References:
  - https://docs.microsoft.com/en-gb/learn/modules/intro-to-azure-virtual-machines/2-compile-a-checklist-for-creating-a-vm

### Virtual Machines
- **Back ups**
  - **Azure Backup**
    - backup as a service that protects physical or virtual machines no matter where they reside.
    - **Using Azure Backup**
      - Utilizes several components that you download and deploy to each computer you want to back up
      - Deployment depends on what you want to protect
        - Azure Backup agent
        - System Center Data Protection Manager
        - Azure Backup Server
        - Azure Backup VM extension
      - Uses Recovery Services vault for storing the backup data.
      - A vault is backed by Azure Storage blobs. 
      - With the vault in place, you can select the machines to back up and define a backup policy (when snapshots are taken)
    - **Advantages**:
      - Designed to work with azure services 
      - Automatic storage management
      - Unlimited scaling
      - Multiple sotrage options
      - Unlimited data transfer
      - Data encryption
      - Application-consistent backup
      - Long-term retention
- **Availability set**
  - To avoid Single Point of Failure, it is recommended to deploy at least two instances of each VM. This feature is called availability set.
  - Availability set is used to ensure a group of related VMs are deployed so they aren't subject to a SPOF, and not all upgraded at the same time during host OS upgrade in data center.
  - When you place VMs into an availability set, Azure guarantees to spread them across Fault Domains and Update Domains.
  - **Fault Domains**
    - Logical group of hardware in Azure sharing common power source and network switch.
    - For availability sets, they will be in different fault domains.
    - Think of it as a **rack** within an on-premises data center.
    - Virtual machines in the same fault domain share a common power source and physical network switch.
  - **Update Domains**
    - Logical group of hardware that can undergo maintenance or be rebooted at the same time.
    - Azure automatically places availability sets into update domains to minimize impact when Azure platform introduces host OS system changes.
    - Azure then processes each update domain one at a time.
    - Virtual machines in the same update domain will be restarted together during planned maintenance. Azure never restarts more than one update domain at a time.
  - **Failover across locations**
    - **Azure Site Recovery** replicates workloads from primary site to secondary location.
      - Azure Site Recovery is about replication of virtual or physical machines; it keeps your workloads available in an outage.
    - If outage at primary site happens then you can fail over to secondary location.
    - **Two main benefits:**
      - Site Recovercy enables use of Azure as a destination for recovery (don't need to use another sceondary physical data center)
      - Site Recovery makes it simple to test failovers for recovery drills without impacting production environments.
- Can create and administer resources in Azure using the following:
  - **Azure Resource Manager**
    - ARM template
    - Allows you to create templates, which can be used to deploy and create specific configurations.
    - You can use automation scripting tools such as the Azure CLI, Azure PowerShell, or even the Azure REST APIs with your favorite programming language to process resource templates, making this a powerful tool for quickly spinning up your infrastructure.
  - **Azure PowerShell**
    - Ideal for one-off interactive tasks and/or automation of repeated tasks
    - Azure PowerShell is an optional add-on package that adds the Azure-specific commands (refferred to as cmdlets). i.e. ``New-AzVm -ResourceGroupName "TestResourceGroup"`` etc...
  - **Azure CLI**
    - Another option for scripting and command-line Azure interaction
    - Cross-platform command-line tool for managing Azure resources 
    - Unlike Azure PowerShell, the Azure CLI does not need PowerShell to function i.e. you can create a vm with ``az vm create --resource-group "ResourceGroup"`` etc
  - **Azure REST API/Programmtic (APIs)**
  - **Azure Client SDK**
    - Higher level of abstraction to Rest APIs
    - **Azure Client SDK encapsulates the Azure REST API**, making it easier for devs to interact with Azure.
    - Available for .NET based languages and others such as C#, Java, Node.js, PHP, Python, Ruby, and Go.
  - **Azure VM Extensions**
    - Small applications that allow you to configure and automate tasks on Azure VMs after initial deployment.
    - Azure VM extensions can be run with the Azure CLI, PowerShell, Azure Resource Manager templates, and the Azure portal.
  - **Azure Automation Services**
    - If have a lot of infrastructure services, consider using services in Azure to help you operate from a higher level
    - Allows you to integrate services that allow frequent automation, of error-prone management tasks.
- Reference: 
  - https://docs.microsoft.com/en-gb/learn/modules/intro-to-azure-virtual-machines/4-describe-other-create-vm-options
  - https://docs.microsoft.com/en-gb/learn/modules/intro-to-azure-virtual-machines/5-high-availability
  - https://docs.microsoft.com/en-gb/learn/modules/intro-to-azure-virtual-machines/6-backup-services

# **Microsoft Labs**
- **Module 2: Deploy and Manage Virtual Machines**
    1. Create Availability set with 1 VM Windows Server 2016 Data center.
    2. Deploy VM using Windows Server data center into existing availability set (from step 1.) using Azure PowerShell
      - Powershell syntax commands are KebabCase. i.e.``New-AzNetworkSecurityGroup -ResourceGroupName $resouceGroup.ResourceGroupName OR Register-AzVirtualMachine OR Get-AzAvailabilitySet etc``
    3. Deploy 2 Linux VMs into an availability set using ARM template
      - To deploy using ARM template, search in market place for ARM template (custom)
      - Load the ARM file and parameters, then run
    4. Configure networking settings for Windows VM as public static IP address and Linux VM as static private IP address
      - Az Portal > Networking blade of VM > click on public IP address > Configuration > change public IP to static
      - Az Portal > Networking blade of VM > click Network Interface > IP configurations > change private IP to static and set to 10.103.0.100
      - Changing private IP address requires restarting Azure VM
      - Choosing static IP address is commonly done where the IP address is used with IP filtering, routing, or assigned to network interfaces of Azure VMs that function as DNS servers.
    5. RDP into Azure Windows datacenter VM via public IP address
      - Az Portal > Networking blade of VM > NSG > Create new inbound security rule allowing TCP connection to port 3389 (RDP) 
      - RDP into it (in Overview in AZ Portal)
    6. SSH into Azure Linux Server VM within the same Virutal Network (by being in the windows VM)
      - CMD: ``nslookup az1000302-vm0``
      - Install putty.exe and SSH into address 10.103.0.100
      - This works because the NSG rules of inbound port rules allow "inside the VNet".
    7. Deploy and configure Azure VM Scale Sets
      - Identify available DNS name for Azure VM Scale set deployment
        - Returns true if available: ``$rg = Get-AzResourceGroup -Name az1000301-RG
Test-AzDnsAvailability -DomainNameLabel <custom-label> -Location $rg.Location``
      - Deploy new SS in Az Portal
        - With Load Balancer settings
      - Once deployed, install IIS on scale set VM by using PowerShell Desired State Conifguration (DSC)
        -  Navigate to SS in AZ Portal > Extensions > PowerShell Desired State Configuration
        - Load the .zip that contains DSC config script to install Web IIS role. 
        - Upgrade the instance to trigger the script.
        - Note the public IP address assigned to the SS, navigate to URL and verify IIS home page shows.
    8. Delete Azure Resources 
      - ``az group list --query "[?starts_with(name,'az1000')].name" --output tsv | xargs -L1 bash -c 'az group delete --name $0 --no-wait --yes'``
- **Module 3: Blob Storage Accounts & File Share**
  1. Deploy Storage accounts using an ARM template
    - To deploy using ARM template, search in market place for ARM template (custom)
    - Load the ARM file and parameters, then run
  2. Deployed 2 storage accounts general purpose v1 and v2, added 2 blob files on v1 storage account
  3. Copied the blob contents from storage acc v1 to storage acc v2 using Azure PowerShell/Cloud shell
    - Storage acc 1 = v1 general purpose, replication = LRS 
      - Cannot modify performance (standard or premium), once it is created. Can modify everything else though.
      - No hot/cool tier
    - Storage acc 2 = v2 general purpose, hot tier, replicatoin = ZRS
    - Issue commands to save storage account 1 and 2 into variables i.e. ``$context1 = ... etc``
    - Issue command to create same container as storage acc 2.
    - Issue command to copy blobs into storage account 2 using those variables i.e. ``az copy $key1 $key2 $context1 $context2 etc...`` (Commands are written from memory so may be incorrect).
    - Verify both storage accs now have the same blobs
  4. Both blob contents are private, so create a SAS token that enables you to view the BLOB
    - Verify you can see the blob contents with the SAS URL.
    - Done.
  5. Create a Azure File Share and mount it to a VM
    - Go to second storage acc > File shares > Create a new one (Any drive)
    - Once created, go to File shares > Overview > Connect
    - Copy the PowerShell commands, and RDP into VM and use PowerShell ISE to use the commands
    - In the VM, you will see the new drive, create new folder and file within it.
    - Verify in Azure > File Share > that the folders have been created
    - DONE.
- References:
  - https://microsoftlearning.github.io/AZ-103-MicrosoftAzureAdministrator/

# **Udemy Course**
- **Types of Permissions**
  - 3 permissions in Azure that are all different from each other:
  - **Subscription level roles (Classic)**
    - This is older, thus classic model (before RBAC existed)
    - Every subscription has 1 Account admin and 1 Service Admin and a Co-Admin, can have up to 200 Co-admin.
    - You see this in the Subscriptions > Properties
    -  **Account admin:**
      - 1 per account
      - Can do everything
      - Can change the billing for a subscription
    - **Service Admin:**
      - 1 per account
      - Same access as Owner role at subscription scope EXCEPT they cannot create new subscriptions, or change billing for subscription etc
      - They can cancel subscriptions and assign users to the Co-Admin role 
    - **Co-Admin:**
      - up to 200 per subscription
      - Same access privileges as Service admin, EXCEPT can't change association of subscriptions to Azure directories
      - Assign users to Co-admin role but cannot change Service Admin
  - **Azure AD Administrator Roles**
    - Azure AD: Authentication and Authorization for Azure AD resources i.e. has multi-factor authentication etc.
    - Used to manage Azure AD resources in a directory such as create or edit users, assign admin roles to others, reset user passwords, manage user licenses, and manage domians.
    - Scope is at tenant level.
    - **Important roles:**
      - **Global Admin**
        - Can do everything
         - Assign admin roles to others
         - Reset passwords for anyone 
      - **User Admin**
        - Create and manage all aspects of users and groups
        - Manage support tickets
        - Monitor service health
        - Change passwords for users, helpdesk admins, and other admins
      - **Billing admin**
        - Make purchases
        - Manage subscriptions
        - Manage support tickets
        - Monitors service health
    - Azure AD Group roles have certain permissions and supports custom roles.
    - Controls who can access your Azure resources programatically (Does the authentication part)
  - **Azure Role Based Access Control (RBAC) Roles**
    - **Authorization** system providing fine-grained access management to Azure resources, such as compute and storage.
    - Includes over 70 built-in roles.
    - **4 Fundamental roles**:
      - **Owner**
        - Full access to all resources
        - Can delegate access to others
      - **Contributor**
        - Create and manage all of types of Azure resources
        - Cannot grant access to others
      - **Reader**
        - View Azure resources
      - **User Access Admin** 
        - Manage user access to Azure resources
    - Create role assignments (Can create custom roles)
      - **Custom Role Based Access Control**
        - Need to use either PowerShell or Azure CLI to create new definition
        - Can get an existing role and work on that role or use a JSON based template to create a new one.
          - i.e. PowerShell: ``$role = Get-AzureRmRoleDefinition -Name "Virtual Machine Contributor"`` Then modify to your liking i.e. ``$role.Id = null`` and create the new role ``New-AzureRmRoleDefinition -Role $role``
          - i.e. JSON template: ``New-AzureRmRoleDefinition -InputFile C:\roleDefinition.json``
    - **Only Azure portal and Azure Resource Manager APIs support RBAC. Users, groups, and applications assigned RBAC roles cannot use Classic deployment model APIs.**
    - Consists of elements: security principal, role definition, and scope.
    - Can apply to subscription level, resource group, or individual resources. If applied at higher levels, then everything within it will inherit the scope.
  - **Differences between Azure RBAC roles, Azure AD roles**
    - **Azure RBAC control permissions to manage Azure resources**
    - **Azure AD admin roles control permissions to manage Azure AD resources.**
  - References:
    - https://docs.microsoft.com/en-us/azure/role-based-access-control/rbac-and-directory-admin-roles
    - https://docs.microsoft.com/en-us/azure/role-based-access-control/overview
- **Monitoring Azure Resources**
  - Diagnostic logs are turned off by default, need to be enabled if wanted
  - Resource level Metrics and performance logs
    - Show metrics from inside the Azure resource i.e. inside the VM: how app is running etc
    - To see this, go to Azure Monitor
    - Resource level metrics:
      - Azure VMs
      - CPU Utilization
      - Info on disk level metrics
      - Info on traffic
    - Performance counters:
      - IIS logs if enabled
      - Tracing from your .NET based application
  - Activity logs
    - Show activity of Azure itself, i.e. created VM, deleted VM etc
    - To see this, go to Azure Monitor
  - **Alerts**
    - Can create alerts on the Activity logs or diagnostic logs, resource level metrics or performance logs
    - Need to create an action group first, then use it (Action group will contain actions: email, SMS, notify specific users etc)
  - **Azure Log Analytics**
    - Lets you search and view log data from various Azure resources
    - You have to create a new Azure Log Analytics if you want it. Just like any other Azure service i.e. App Service, VM etc
    - It is now part of Azure Monitor (was separate before)
    - Use case - You want to perform interactive queries on the performance metrics
    - **Why**
      - Central location for all of your logs
      - Can query all logs using API calls. So you can create your own custom dashboiards etc.
    - Has **pricing tiers**
    - Can view these logs by going to the Azure Analytics Workspace resource itself, or in Azure Monitor, under the Logs side menu. 
    - **You will have to connect your applications to this (i.e. VM, you will have to connect it via Azure Analytics Workspace)**
      - In the background, extension is installed, a monitoring agent will send stats from the VM onto our logs workspace.
      - Specify what you want to collect!
      - **Can also collect Data and performance metrics from your on-premises servers, not only Azure!**
      - Go to Advanced settings > Data > Specify what you want to collect i.e. Performance Counters, Windows event logs etc. 
  - **Azure Monitor**
    - Azure monitor shows these logs (metrics, activity)
    - Centralized monitoring service 
    - Metrics tab - Can graph metrics (also by tags)
    - Has Azure Log Analytics
    - Logs tab - Azure Log Analytics logs (You have to create Azure Log Analytics)  
- **Resource Tagging**
  - Tagging resources allows you to identify resources for billing reasons and organise your resources etc. i.e. Tag by environment (name: environment, value: Staging) or by departments (name: department, value: HR) etc.
  - Type Tags into Azure, here you can see all distinct tags and the resources located with it.
  - Can create multiple tags (name, value pairs) to any Azure resources
- **Costing in Azure**
  - **Cost Management**
    - In Azure, Go to Cost Management - Billing
    - Will allow you to see billing based on tags and more! Very useful
    - **Cost Analysis is part of your subscription**
      - **Overview (gives good overview whether you will go overbudget)**
        - Current spending
        - See spending per resource
        - See your forecasts 
        - Will also show any free services you have and if you are coming up to it's limits
    - **Cost Analysis**
      - See spending history
      - See spending based on tags, resource types etc
      - In Azure, Go to Cost Management - Billing > Cost Analysis > Filter by tags etc
      - Can also download any cost reports
    - **Invoices**
      - This is just like a bill (invoices - how much was spent, which period etc)
      - If you want to see a detailed report, then go to Cost Analysis and download the report instead.
  - **Azure Advisor**
    - Gives recommendations on costing perspective
    - i.e. You could save $260 if you buy a reserved instance etc... 
- **Moving Azure Resources**
  - You can move **resources across resource groups in a tenant**
    - **Resources will still remain in the same location, even if resource group belongs in another location.**
    - Validate your source and destination subscription belong to the same tenant by issuing these PowerShell commands:
      - ``(Get-AzureRmSubscription-SubscriptionName <your-source-subscription>).TenantId``
      - ``(Get-AzureRmSubscription-SubscriptionName <your-destination-subscription>).TenantId``
      - If not same tenant, then you have to do extra steps in the documentation...
    - **Resources that cannot be moved**
      - AD Domain services, Container services
      - **Limitations for VMs**
        - VMs with cert stored in Key Vault can be moved to a new resource group in the same subscription, but not across subscriptions
        - VMs configured with Azure Backup cannot be moved
      - **Limitations for Virtual Networks**
        - Have to move all resources within the network
        - If network has been peered, have to remove peering first.
      - **Limitations for classic deployments**
        - VNets (classic) can't be moved
        - VMs (classic) must be moved with the cloud service.
- **Azure Policies**
  - In Azure, Type in Policy, and go to Policy.
  - Use in-built or create your own rules to enforce resources defined in Azure
    - e.g Resource groups can only be created if they have certain tags attached
    - e.g. When a VM is created, needs to be certain SKU size 
  - Different from RBAC:
    - RBAC: gives you permission to do something in Azure
    - Azure Policies: Governane, more drilled down approach. 
  - **Take around 10-30 mins to take into effect.**
  - In Policy in Azure, you can see the existing resources that do not obey the policy.
    - Any new resources you create will have to obey the policy, however, existing ones that were already created may not have adhered to the policy.
- **Azure Storage Account: Service Types**
  - **Blob storage/service**
    - Object-level storage (store objects)
    - Disk files for your VM (VHD)
  - **Table storage/service**
    - Simple structure and quick access
  - **File storage/service**
    - File shares
    - Connect to file storage via server message block protocol (SMB) protocol
    - Gets all stored in Azure Cloud, fully managed in the cloud
      - No need to maintain these files on your on-premises server, or config network etc
    - **Can connect directly to the File Share from Windows or Linux machines (Azure will give you command)**
      - Use it to Map a drive from local machine onto the file share in Azure using Access Key
      - You can then create files or folders as you would any other directory folder etc.
    - Can use Azure Backup to back up fle shares
  - **Queue service**
    - Sending messages  
- **Storage Accounts**
  - **Types:**
    - **Block blob storage accounts**
      - Only used to store Blob objects
      - Can't store VHD files.
    - **FileStorage storage accounts**
      - Only used for storage of files
    - **General Purpose v1 accounts**
      - Can use Blob, File, Queue and Table Service
    - **General Purpose v2 accounts**
      - Can use Blob, File, Queue and Table Service
      - This is latest version with all features.
      - Zone redundant replication is only available for v2 
  - **Performance Tiers**
    - **Standard**
      - Storing blobs, files, tables, queues and Azure VM disks  
    - **Premium**
      - Storing unmanaged virtual machine disks only
  - **Access Tiers**
    - **Hot**
      - Used for accessing objects that are accessed frequently
      - Storage costs are higher, but access costs are lower
    - **Cool** 
      - Optimized for storing large amounts of data and stored for at least 30 days.
      - Used for accessing objects that are accessed infrequently
      - Storage costs are cheaper, but access costs are higher
    - **Archive**
      - Used for archive data, **only available for blob service level** and not at the account level.
      - Could be waiting several hours to download the data
      - Storage costs are lower than the cool tier but access costs are higher than the cool or hot tier.
  - **Storage Account Replication**
    - **Locally-redundant storage (LRS)**
      - Least highly available option, but **cheapest option** (cost effective option)
      - Data replicated into 3 storage locations within 1 storage unit, within a 1 data center, within a 1 region/location
      - The data is stored physically all in 1 location.
      - A write is only successful if made into all 3 different storage locations within the storage unit.
    - **Zone-redundant storage (ZRS)**
      - More highly available
      - Replicated across 3 storage clusters, each cluster is physically separated from each other using Availability Zones but in 1 region.
      - Each storage cluster is stored in separate availability zone (or data center).
      - If 1 data center goes down, you still have your data available in other data centers!
    - **Geo-redundant storage (GRS)**
      - Data replicated into 3 storage locations within 1 storage unit, within 1 data center, within 1 region (same as LRS), however, it gets copied synchronously to another region/location (so now you have **Primary region** and **secondary region**)
      - The copy happens synchronously
      - If primary region goes down, a **fail over onto the secondary region will happen**
      - With GRS, you can only read from the primary region, unless a failover happens, then you can read from the secondary.
      - High cost
    - **Read-access geo-redundant storage (RA-GRS)**
      - Same as GRS, however, **both primary and secondary regions will always be available to you to READ.**
      - Highest cost compared with all options (since you can read in both regions)
- **Blob Service**
  - Has special access tier called Archive (see access tiers above).
  - Blobs require containers
    - Containers have 3 public access levels:
      - **Private**
      - **Blob**
      - **Container**
    - **Access keys**
      - At the account level!
      - get 2 access keys for your storage account
        - Allows you to regenerate any of the keys and render the prev invalid if someone else gets access etc.
      - Access to all services in storage account
      - Gives a user access to everything in the storage account!
      - No concept of start and end time (only SAS will have that)
    - **Shared Access Signatures (SAS)**
      - At the service level, and more specific access in the storage account
      - More secure than access keys, because more specific access
      - Users will not see everything in the storage account, but only those that they have access to with the SAS!
      - Here you do not need to provide your access keys to access the storage.
      - **Two types**
        - At the service level
          - Only gives access to either Blob, Queue, Table or File
          - Can limit the service that can be used
        - Account level
          - Access to all the services in the account
      - **Features**
        - Gives you a SAS URL and you can get a start and end time for the access.
        - Can have start and end time for access (this is not possible with access keys)
        - Can also whitelist IP address so only those IP's can view it etc. 
- **Azure Storage Explorer**
  - Free tools that works with all Azure account services (Storage accounts, Files, Blobs, Tables etc)
- **Azure Backup**
  - Backup service available in Azure.
  - Backup data onto Azure cloud
  - Backup Azure VMs
  - Backup on-premise machines and workloads
  - Can backup Azure file shares 
  - **Features**
    - Don't need to worry about the storage (azure manages this for you)
    - Backup is secure (encrypted in transit and at rest)
    - Can have short and long term backups
    - No limit to inbound or outbound transfer
  - **Create an Azure Recovery Services Vault**
    - Two functions: 
      - Backup
      - Replicate (Site Recovery)
    - Region for your vault and region for your file share need to be the same.
      - Because it tries to find and configure the storage accounts in the same region of the Azure Recovery vault.
  - **Process for file share backup**
    - Create Azure Recovery services vault
    - Specify a backup - Storage account, file share and backup policy
      - Backup policy: You can only backup only once a day for file share (but keep in mind, you can also do manual backups any times you want)
      - Specify how many days retained (30 days default)
    - Enable backup
    - Carry out a backup operation
      - Go to Azure Recovery services vault > backup items > select your backup item > Backup now
      - Limit 4 times a day
    - This will create a restore point
    - Perform a restore operation
      - Go to Azure Recovery services vault > backup items > select your backup item > Restore Share OR File Recovery
      - File recovery: Restores file
      - Restore Share: restore whole file share
      - You can restore the file to overwrite existing file, or provide alternative location.
  - **Delete the Azure Recovery services vault**
    - Stop any backup operations
    - Delete any backup data
      - Go to Azure Recovery services vault > backup items > select your backup item > stop backups
    - Unregister the storage account
      - Go to Azure Recovery services vault > backup infrastructure > storage accounts > unregister storage account
    - THEN delete the recovery azure recovery vault.
  - **Azure File Sync**
    - Distributed file system: syncs data across your on-premise file servers
    - Files are stored in Azure File Share
    - Data can then be cached on your on-premise servers
    - **Pre-requisites**
      - Storage account with Azure File share
      - Ensure Azure file sync is available in the desired region
    - **Preparing Azure**
      - Deploy **Storage Sync Service** in your resource group
      - Create a sync group. Specify storage account here.
        - This creates an entity called cloud endpoint. It is an endpoint that points to the file share in your account.
    - **Preparing your server**
      - Your on-premise Windows server is running Windows server 2012 R2 or higher
      - Ensure powershell 5.1 is running on your system
      - Install the Azure RM module
      - Your server configuration for IE enhanced security is off for administrators and users
      - Download and install Azure File Sync agent
        - Go on IE and download the Azure File Sync agents (google it)
        - Register your on-premise server through Azure File Sync agent (install it and it will pop up) 
        - See if successful: Go to Azure portal > Sync group (created earlier in the steps) > Registered servers 
        - Register the on-premises servers using the Azure File Sync agent
      - **Map cloud endpoint to server endpoints:** Go to resource group > storage sync service > Azure Sync Group > choose sync group created > select cloud endpoint and add the registered server endpoint 
      - You can add multiple server endpoints, which will automatically sync files to those servers.
    - **Cloud Tiering**
      - Allows you to control the space on the volume that's available in the local windows server
      - **Specify a percentage:** this is the percentage that should always be free on the local volume, on the local Windows server. 
      - The way it does this is a **pointer** to the file share, if you allocate 100% percentage, then the file will be 0 bytes on the local machine, when you double click on it - then it will get the file from the share as nothing is stored on the local machine.
  - **Azure Import/Export Service**
    - Used to securely transfer **large amounts** of data to Azure BLOB storage and Azure files
    - Need to transfer the files you need to import onto a disk. **Then need to ship the disks to Azure Data Center.** They will import it for you.
    - Can use **Azure Data Box Disk** to import data into Azure if you want to transfer data using disk drives supplied by Microsoft
    - Can create both Import and Export jobs
    - **Export Disk: Instructions**
      - Exported disk needs to be encrypted with Bitlocker (required for WAImport).
        - Requires windows 10 enterprise or professional edition
        - Encrypts the password which is then used in the WAImportExport instructions 
      - Download Microsoft Azure Import/Export tool
      - First need to download an exe called WAImportExportv1
        - Need to run powershell commands, use the exe to prepare the files that need to be exported
        - The exe will create journal file and DriveManifest.xml file which needs to be used when creating the Import job.
      - In Azure Portal create import/export job > Import into azure > upload the journal file etc...
      - After **import job is created, courier the disk drive to Microsoft**
      - Then monitor the status of the Import job in Azure portal
  - **Command line options**
    1. **PowerShell**
      - Install azure modules required: ``Install-Module -Name AzureRM -AllowClobber -force``
      - Configure to sign in remotely: ``powershell Set-ExecutionPolicy RemoteSigned``
      - Login: ``Login-AzureRmAccount``
      - Commands are similar to this: i.e. ``Get-AzureRmStorageAccount -ResourceGroupName "azuredemo"``
      - **New PowerShell commands:**
        - Shortened to use Az instead of AzureRm
        - i.e. ``Get-AzStorageAccount -ResourceGroupName "resourceGroupName" -Name "name"``
    2. **Azure CLI**
      - Made to work with Azure specifically
      - Login: ``az login``
      - Commands start with az: i.e. ``az storage account keys list --acount-name accountName --resource-group azuredemo --output table``
    3. **Azure Cloud Shell**
      - Requires storage account + file share (to store session details)
      - Can use bash or PowerShell (if using powershell can still issue Azure CLI commands ``i.e az storage account etc``)
- **Virtual Machine**
  - Not responsible for the physical server on Azure (IaaS)
  - Only responsible for VM (IaaS)
  - **Deploying Virtual Machines**
    - When deploying a Virtual Server (VM) the following also get deployed:
      - Virtual network (VM will be within a subnet in this VNet)
      - NSG
      - Network Interface (where IP address is allocated)
      - VHD + OS Disk and Data disk
    - **Costing:** VM + storage disks 
  - **Install IIS into a VM**
    - RDP into windows server VM
    - [Remote Desktop] Go to Server Manager on the machine > Add roles and features > Role-based installation > [features tab] Server Role = web server (IIS) > Install
  - Linux server in Azure
    - SSH using Putty
- **Configuration Management**
  - **PowerShell Desired State Configuration (DSC)**
    - Enables you to run scripts that modify the VM into your desired state
    - Extension on Azure 
    - You can define script whcih conforms to particular syntax
    - This script will automatically run on new VMs
    - It ensures your VM conforms to a particular Desired state.
    - Scripts need to be in .ps1 (powershell) format and be in a zip folder
    - Example: ``configuration IIS { node "localhost" { WindowsFeature IIS { Ensure="Present" Name="Web-Server"} }} ``    
      - Configuration = Details about what needs to be done on the server
      - Node = The node the script should run
      - Within the node, you can have many features. In this case, installs IIS
      - **This is an automated script to install IIS** in your VM
    - **How to run the DSC script**
     - Have your powershell Script (.ps1) and zip the file
     - In Azure > VM > Extensions > Search for PowerShell DSC > Create > Upload the zip folder and fill the rest in (version can be 2.21) 
     - This will automatically execute once it is installed on the VM
  - **Custom Script Extension**
    - Can also use Custom scripts extension to execute scripts on VMs that you cant be done on PowerShell DSC
    - This is good when you want to run adhoc or custom based scripts.
    - **How to run the Custom Script extension**
      - In Azure > VM > Extensions > Search for Custom Script > Select script > Done.
      - You can pass parameters etc to the script.
  - **Adding a data disk to VM**
    - Azure Portal > Vms > Disks > Add Data Disks > Create > Save 
    - **Should host data in an application on a Data Disk** 
    - To verify it has been created, go to Windows Server VM > File and Storage Services > Disks
      - The disk will be created but still needs to be partitioned etc...
      - You still need to create a volume out of the disk.
  - **VM SLA**
    - 99.9% for 1 VM
    - 99.95% using availability sets (2 or more VMs in the set)
    - 99.99% using availability zones (VMs across different zones)
  - **Availability Sets**
    - SLA of 99.95%
    - **Fault Domains**
      - Max is 3
      - **Each fault domain is connected to a separate physical hardware** i.e. Different rack or network supply etc
    - **Update Domains**
      - Max is 20
      - Helps in the rebooting services for patches
      - **Each update domain will always be rebooted separately**
    - **Unmanaged Disks**
      - Responsible for maintaining the storage accounts and that the disks are placed in the storage accounts
    - **Managed Disks**
      - Recommended if VM is part of AS.
      - Provide better reliability in AS by ensuring disks of VMs in AS are sufficiently isolated from each other to avoid SPOF.
    - **Configure each application tier as part of a different availability set**
      - Do not put them together!
  - **Availability Zones**
